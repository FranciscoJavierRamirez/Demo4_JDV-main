---
import { getEntry } from 'astro:content';

const benefitsData = await getEntry('benefits', 'home');
if (!benefitsData || !benefitsData.data) {
  throw new Error('Benefits content entry could not be loaded');
}
const { sectionTitle, benefits } = benefitsData.data;
---

<!-- Benefits Section - High Contrast Dark Mode -->
<section id="benefits" class="relative py-24 bg-(--blue-deeper) overflow-hidden">
  
  <!-- Transition gradient from AreasGrid -->
  <div class="absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-[rgba(26,77,122,0.6)] via-[rgba(37,99,235,0.2)] to-transparent pointer-events-none"></div>

  <!-- Decorative Background Elements -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden">
    <!-- Grid Pattern -->
    <div class="absolute inset-0 opacity-[0.05]" style="background-image: linear-gradient(rgba(255,255,255,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.3) 1px, transparent 1px); background-size: 40px 40px;"></div>

    <!-- Primary Glow Orbs -->
    <div class="absolute top-[-10%] left-[15%] w-[55%] h-[55%] bg-[radial-gradient(circle,rgba(59,130,246,0.4)_0%,transparent_65%)] blur-[100px] rounded-full animate-[benefitsFloat_20s_ease-in-out_infinite]"></div>
    <div class="absolute bottom-[-15%] right-[10%] w-[50%] h-[50%] bg-[radial-gradient(circle,rgba(37,99,235,0.35)_0%,transparent_65%)] blur-[90px] rounded-full animate-[benefitsFloat_24s_ease-in-out_infinite_reverse]"></div>
    <!-- Secondary lighter orbs -->
    <div class="absolute top-[30%] right-[5%] w-[40%] h-[40%] bg-[radial-gradient(circle,rgba(96,165,250,0.25)_0%,transparent_60%)] blur-[110px] rounded-full animate-[benefitsFloat_18s_ease-in-out_4s_infinite]"></div>
    <div class="absolute bottom-[10%] left-[5%] w-[35%] h-[35%] bg-[radial-gradient(circle,rgba(59,130,246,0.2)_0%,transparent_60%)] blur-[90px] rounded-full animate-[benefitsFloat_22s_ease-in-out_6s_infinite_reverse]"></div>
    <!-- Gold accent orbs -->
    <div class="absolute top-[50%] left-[30%] w-[30%] h-[30%] bg-[radial-gradient(circle,rgba(201,162,84,0.18)_0%,transparent_65%)] blur-[80px] rounded-full animate-[benefitsFloat_15s_ease-in-out_3s_infinite]"></div>
    <div class="absolute top-[10%] right-[25%] w-[25%] h-[25%] bg-[radial-gradient(circle,rgba(201,169,97,0.12)_0%,transparent_60%)] blur-[70px] rounded-full animate-[benefitsFloat_17s_ease-in-out_8s_infinite_reverse]"></div>
  </div>

  <!-- Gradient Overlay - lighter to let orbs show -->
  <div class="absolute inset-0 bg-gradient-to-br from-[rgba(12,35,64,0.85)] via-[rgba(12,35,64,0.78)] to-[rgba(26,77,122,0.72)] pointer-events-none"></div>

  <div class="container relative z-10">
    <!-- Section Header -->
    <div class="benefits-header text-center mb-16">
      <h2 class="text-[clamp(2rem,4vw,3rem)] font-extrabold text-white mb-6 tracking-[-0.02em] drop-shadow-lg" style="font-family: var(--font-display);">
        {sectionTitle}
      </h2>
      <div class="w-24 h-1 bg-linear-to-r from-(--gold) to-transparent mx-auto rounded-full opacity-80"></div>
    </div>

    <!-- Benefits Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {benefits.map((benefit, index) => (
        <div 
          class="benefit-card group relative p-8 rounded-[24px] bg-white/5 backdrop-blur-md border border-white/10 transition-all duration-300 hover:bg-white/10 hover:translate-y-[-5px] hover:border-[rgba(201,169,97,0.5)] hover:shadow-[0_8px_32px_rgba(201,169,97,0.35),0_0_60px_rgba(201,169,97,0.2),0_0_100px_rgba(201,169,97,0.1),0_20px_40px_rgba(0,0,0,0.25)] overflow-hidden"
          data-index={index}
        >
          <!-- Hover Gradient Glow -->
          <div class="absolute inset-0 bg-linear-to-br from-(--gold)/0 via-(--gold)/0 to-(--gold)/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

          <!-- Icon -->
          <div class="benefit-icon relative w-16 h-16 flex items-center justify-center rounded-2xl bg-linear-to-br from-white/10 to-white/5 border border-white/10 mb-6 group-hover:scale-110 group-hover:border-(--gold)/30 transition-all duration-300 shadow-inner">
            <i class={`${benefit.icon} text-2xl text-(--gold) drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)]`}></i>
          </div>
          
          <!-- Title -->
          <h3 class="text-xl font-bold text-white mb-4 group-hover:text-(--gold-light) transition-colors" style="font-family: var(--font-display);">
            {benefit.title}
          </h3>
          
          <!-- Text -->
          <p class="text-white/70 leading-relaxed text-sm font-light">
            {benefit.text}
          </p>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  @keyframes benefitsFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -20px) scale(1.05); }
    66% { transform: translate(-20px, 15px) scale(0.95); }
  }

  /* ========================================
     Benefits Section Scroll Reveal Animations
     ======================================== */
  
  /* Header entrance - fade down with scale */
  .benefits-header {
    opacity: 0;
    transform: translateY(-20px) scale(0.98);
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1), 
                transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .benefits-header.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* Benefit cards - fade up with staggered delays */
  .benefit-card {
    opacity: 0;
    transform: translateY(40px) scale(0.95);
  }

  .benefit-card.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), 
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Staggered delays using data-index */
  .benefit-card[data-index="0"].visible { transition-delay: 0ms; }
  .benefit-card[data-index="1"].visible { transition-delay: 120ms; }
  .benefit-card[data-index="2"].visible { transition-delay: 240ms; }
  .benefit-card[data-index="3"].visible { transition-delay: 360ms; }

  /* Icon micro-animation on card reveal */
  .benefit-icon {
    opacity: 0;
    transform: scale(0.8) rotate(-10deg);
  }

  .benefit-card.visible .benefit-icon {
    animation: iconReveal 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  /* Staggered icon animation delays matching card delays + offset */
  .benefit-card[data-index="0"].visible .benefit-icon { animation-delay: 0.2s; }
  .benefit-card[data-index="1"].visible .benefit-icon { animation-delay: 0.32s; }
  .benefit-card[data-index="2"].visible .benefit-icon { animation-delay: 0.44s; }
  .benefit-card[data-index="3"].visible .benefit-icon { animation-delay: 0.56s; }

  @keyframes iconReveal {
    0% { 
      opacity: 0;
      transform: scale(0.8) rotate(-10deg); 
    }
    60% { 
      opacity: 1;
      transform: scale(1.1) rotate(5deg); 
    }
    100% { 
      opacity: 1;
      transform: scale(1) rotate(0deg); 
    }
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .benefits-header,
    .benefit-card,
    .benefit-icon {
      opacity: 1;
      transform: none;
      transition: none;
      animation: none;
    }
  }
</style>

<script>
  // ========================================
  // Benefits Section - Scroll Reveal Animation
  // ========================================
  const initBenefitsAnimation = () => {
    const section = document.querySelector('#benefits');
    const header = section?.querySelector('.benefits-header');
    const cards = section?.querySelectorAll('.benefit-card');

    if (!section) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (prefersReducedMotion) {
      // Show everything immediately without animation
      header?.classList.add('visible');
      cards?.forEach(card => card.classList.add('visible'));
      return;
    }

    const observerOptions: IntersectionObserverInit = {
      threshold: 0.15,
      rootMargin: '0px 0px -50px 0px'
    };

    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Animate header first
          header?.classList.add('visible');

          // Then animate cards with staggered delay
          cards?.forEach((card, index) => {
            setTimeout(() => {
              card.classList.add('visible');
            }, 100 + (index * 100));
          });

          // Stop observing after animation triggered
          revealObserver.disconnect();
        }
      });
    }, observerOptions);

    revealObserver.observe(section);

    // Fallback con delay para Chrome (si el observer no dispara en 500ms)
    setTimeout(() => {
      if (!header?.classList.contains('visible')) {
        const rect = section.getBoundingClientRect();
        if (rect.top < window.innerHeight && rect.bottom >= 0) {
          header?.classList.add('visible');
          cards?.forEach((card, index) => {
            setTimeout(() => card.classList.add('visible'), 100 + (index * 100));
          });
          revealObserver.disconnect();
        }
      }
    }, 500);
  };

  // Run on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBenefitsAnimation);
  } else {
    initBenefitsAnimation();
  }
</script>
