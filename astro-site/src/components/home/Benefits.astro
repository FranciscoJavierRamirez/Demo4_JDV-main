---
import { getEntry } from 'astro:content';

const benefitsData = await getEntry('benefits', 'home');
if (!benefitsData || !benefitsData.data) {
  throw new Error('Benefits content entry could not be loaded');
}
const { sectionTitle, benefits } = benefitsData.data;
---

<!-- Benefits Section - High Contrast Dark Mode -->
<section id="benefits" class="relative py-24 bg-(--blue-deeper) overflow-hidden">
  
  <!-- Decorative Background Elements -->
  <div class="absolute inset-0 pointer-events-none">
    <!-- Grid Pattern -->
    <div class="absolute inset-0 opacity-[0.05]" style="background-image: linear-gradient(rgba(255,255,255,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.3) 1px, transparent 1px); background-size: 40px 40px;"></div>
    
    <!-- Glow Orbs -->
    <div class="absolute top-0 left-1/4 w-[600px] h-[600px] bg-[radial-gradient(circle,rgba(59,130,246,0.15)_0%,transparent_70%)] blur-[100px] rounded-full mix-blend-screen animate-[pulseGlow_8s_ease-in-out_infinite]"></div>
    <div class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-[radial-gradient(circle,rgba(201,162,84,0.1)_0%,transparent_70%)] blur-[100px] rounded-full mix-blend-screen animate-[pulseGlow_10s_ease-in-out_infinite_reverse]"></div>
  </div>

  <div class="container relative z-10">
    <!-- Section Header -->
    <div class="benefits-header text-center mb-16">
      <h2 class="text-[clamp(2rem,4vw,3rem)] font-extrabold text-white mb-6 tracking-[-0.02em] drop-shadow-lg" style="font-family: var(--font-display);">
        {sectionTitle}
      </h2>
      <div class="w-24 h-1 bg-linear-to-r from-(--gold) to-transparent mx-auto rounded-full opacity-80"></div>
    </div>

    <!-- Benefits Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {benefits.map((benefit, index) => (
        <div 
          class="benefit-card group relative p-8 rounded-[24px] bg-white/5 backdrop-blur-md border border-white/10 transition-all duration-300 hover:bg-white/10 hover:translate-y-[-5px] hover:shadow-[0_8px_32px_rgba(0,0,0,0.3)] overflow-hidden"
          data-index={index}
        >
          <!-- Hover Gradient Glow -->
          <div class="absolute inset-0 bg-linear-to-br from-(--gold)/0 via-(--gold)/0 to-(--gold)/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

          <!-- Icon -->
          <div class="benefit-icon relative w-16 h-16 flex items-center justify-center rounded-2xl bg-linear-to-br from-white/10 to-white/5 border border-white/10 mb-6 group-hover:scale-110 group-hover:border-(--gold)/30 transition-all duration-300 shadow-inner">
            <i class={`${benefit.icon} text-2xl text-(--gold) drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)]`}></i>
          </div>
          
          <!-- Title -->
          <h3 class="text-xl font-bold text-white mb-4 group-hover:text-(--gold-light) transition-colors" style="font-family: var(--font-display);">
            {benefit.title}
          </h3>
          
          <!-- Text -->
          <p class="text-white/70 leading-relaxed text-sm font-light">
            {benefit.text}
          </p>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  /* ========================================
     Benefits Section Scroll Reveal Animations
     ======================================== */
  
  /* Header entrance - fade down with scale */
  .benefits-header {
    opacity: 0;
    transform: translateY(-20px) scale(0.98);
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1), 
                transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .benefits-header.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* Benefit cards - fade up with staggered delays */
  .benefit-card {
    opacity: 0;
    transform: translateY(40px) scale(0.95);
  }

  .benefit-card.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), 
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Staggered delays using data-index */
  .benefit-card[data-index="0"].visible { transition-delay: 0ms; }
  .benefit-card[data-index="1"].visible { transition-delay: 120ms; }
  .benefit-card[data-index="2"].visible { transition-delay: 240ms; }
  .benefit-card[data-index="3"].visible { transition-delay: 360ms; }

  /* Icon micro-animation on card reveal */
  .benefit-icon {
    opacity: 0;
    transform: scale(0.8) rotate(-10deg);
  }

  .benefit-card.visible .benefit-icon {
    animation: iconReveal 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  /* Staggered icon animation delays matching card delays + offset */
  .benefit-card[data-index="0"].visible .benefit-icon { animation-delay: 0.2s; }
  .benefit-card[data-index="1"].visible .benefit-icon { animation-delay: 0.32s; }
  .benefit-card[data-index="2"].visible .benefit-icon { animation-delay: 0.44s; }
  .benefit-card[data-index="3"].visible .benefit-icon { animation-delay: 0.56s; }

  @keyframes iconReveal {
    0% { 
      opacity: 0;
      transform: scale(0.8) rotate(-10deg); 
    }
    60% { 
      opacity: 1;
      transform: scale(1.1) rotate(5deg); 
    }
    100% { 
      opacity: 1;
      transform: scale(1) rotate(0deg); 
    }
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .benefits-header,
    .benefit-card,
    .benefit-icon {
      opacity: 1;
      transform: none;
      transition: none;
      animation: none;
    }
  }
</style>

<script>
  // ========================================
  // Benefits Section - Scroll Reveal Animation
  // ========================================
  const initBenefitsAnimation = () => {
    const section = document.querySelector('#benefits');
    const header = section?.querySelector('.benefits-header');
    const cards = section?.querySelectorAll('.benefit-card');

    if (!section) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (prefersReducedMotion) {
      // Show everything immediately without animation
      header?.classList.add('visible');
      cards?.forEach(card => card.classList.add('visible'));
      return;
    }

    const observerOptions: IntersectionObserverInit = {
      threshold: 0.15,
      rootMargin: '0px 0px -50px 0px'
    };

    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Animate header first
          header?.classList.add('visible');

          // Then animate cards with staggered delay
          cards?.forEach((card, index) => {
            setTimeout(() => {
              card.classList.add('visible');
            }, 100 + (index * 100));
          });

          // Stop observing after animation triggered
          revealObserver.disconnect();
        }
      });
    }, observerOptions);

    revealObserver.observe(section);
  };

  // Run on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBenefitsAnimation);
  } else {
    initBenefitsAnimation();
  }
</script>
