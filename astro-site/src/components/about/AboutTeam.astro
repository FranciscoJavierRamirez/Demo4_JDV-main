---
import { getCollection } from 'astro:content';
import TeamSection from './TeamSection';

interface Props {
  title: string;
  subtitle: string;
  structureTitle?: string;
  structureDescription?: string;
}

const { title, subtitle, structureTitle, structureDescription } = Astro.props;

// Obtener todos los miembros del equipo ordenados
const teamMembers = await getCollection('team');
const sortedMembers = teamMembers.sort((a, b) => a.data.order - b.data.order);

// Separar fundadora de asociados
const founder = sortedMembers.find(m => m.data.featured);
const associates = sortedMembers.filter(m => !m.data.featured);

// Preparar datos para el componente React
const founderData = founder?.data;
const associatesData = associates.map(m => m.data);
---

<section id="team" class="relative py-20 md:py-28 lg:py-32 overflow-hidden bg-[var(--blue-deeper)]">
  <!-- Complex Mesh Gradient Background (Hero-style) -->
  <div class="absolute inset-0 z-0">
    <div class="absolute top-[-20%] left-[-10%] w-[70%] h-[70%] rounded-full 
         bg-[radial-gradient(circle,rgba(59,130,246,0.4)_0%,transparent_70%)] 
         blur-[120px] animate-[float_20s_ease-in-out_infinite]"></div>
    <div class="absolute bottom-[-10%] right-[-5%] w-[60%] h-[60%] rounded-full 
         bg-[radial-gradient(circle,rgba(29,78,216,0.4)_0%,transparent_70%)] 
         blur-[100px] animate-[float_25s_ease-in-out_infinite_reverse]"></div>
    <div class="absolute top-[40%] left-[30%] w-[40%] h-[40%] rounded-full 
         bg-[radial-gradient(circle,rgba(201,162,84,0.15)_0%,transparent_70%)] 
         blur-[80px] animate-[float_15s_ease-in-out_infinite_5s]"></div>
  </div>

  <!-- Noise Texture Overlay -->
  <div class="absolute inset-0 z-1 opacity-[0.03] pointer-events-none mix-blend-overlay" 
       style="background-image: url('data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noise\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noise)\'/%3E%3C/svg%3E');"></div>

  <!-- Gradient Overlay for Depth -->
  <div class="absolute inset-0 z-2 bg-gradient-to-br from-[rgba(12,35,64,0.98)] via-[rgba(12,35,64,0.94)] to-[rgba(26,77,122,0.88)]"></div>

  <div class="container relative z-10">
    <!-- Section Header with Glassmorphism -->
    <div class="team-header text-center mb-12 md:mb-16">
      <!-- Badge glassmorphism (Hero-style) -->
      <span class="inline-flex items-center gap-2 px-3 py-1.5 sm:px-4 sm:py-2 
                   bg-white/10 backdrop-blur-lg rounded-full 
                   border border-white/20 text-xs sm:text-sm font-semibold text-white 
                   mb-3 sm:mb-4 shadow-lg">
        <i class="fas fa-users text-[var(--gold)] text-sm"></i>
        Nuestro Equipo
      </span>

      <!-- Título blanco -->
      <h2 class="text-[clamp(2rem,4vw,3rem)] font-bold text-white mb-3 sm:mb-4 
                 drop-shadow-[0_2px_8px_rgba(0,0,0,0.3)] px-4" 
          style="font-family: var(--font-display);">
        {title}
      </h2>

      <!-- Subtítulo -->
      <p class="text-base sm:text-lg text-white/80 max-w-xl mx-auto px-4">
        {subtitle}
      </p>
      
      <!-- Divider dorado -->
      <div class="w-24 h-1 bg-gradient-to-r from-[var(--gold)] to-transparent 
                  mx-auto mt-6 rounded-full opacity-80"></div>
    </div>

    <!-- Team Section (Founder + Associates + Modal) -->
    <TeamSection
      founder={founderData}
      associates={associatesData}
      client:visible
    />

    <!-- Bloque explicativo: Estructura del Estudio -->
    {structureTitle && structureDescription && (
      <div class="structure-block max-w-3xl mx-auto mt-10 md:mt-14 px-4">
        <div class="bg-white/5 backdrop-blur-sm border border-[var(--gold)]/30
                    rounded-2xl p-6 md:p-8 shadow-lg">
          <h3 class="text-xl md:text-2xl font-bold text-white mb-4
                     flex items-center gap-3"
              style="font-family: var(--font-display);">
            <span class="w-8 h-8 rounded-full bg-[var(--gold)]/20
                         flex items-center justify-center">
              <i class="fas fa-sitemap text-[var(--gold)] text-sm"></i>
            </span>
            {structureTitle}
          </h3>
          <div class="text-white/80 text-base leading-relaxed space-y-4">
            {structureDescription.split('\n\n').map((paragraph: string) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </div>
      </div>
    )}
  </div>
</section>

<style>
  /* ========================================
     Team Section Premium Animations
     ======================================== */

  /* Header entrance - Slide down with bounce */
  .team-header {
    opacity: 0;
    transform: translateY(-30px);
    animation: slideInDown 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s forwards;
  }

  @keyframes slideInDown {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Float animations para orbes */
  @keyframes float {
    0%, 100% { 
      transform: translate(0, 0) scale(1); 
    }
    33% { 
      transform: translate(60px, -80px) scale(1.1); 
    }
    66% { 
      transform: translate(-60px, 60px) scale(0.9); 
    }
  }

  /* Shimmer effect para badge fundadora */
  @keyframes shimmer {
    0% { 
      left: -100%; 
    }
    100% { 
      left: 100%; 
    }
  }

  /* Structure block entrance animation */
  .structure-block {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.4s forwards;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .team-header,
    .structure-block {
      opacity: 1;
      transform: none;
      animation: none;
    }
    
    [class*="animate-[float"] {
      animation: none !important;
    }

    [class*="animate-[shimmer"] {
      animation: none !important;
    }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    #team {
      padding-top: 3rem;
      padding-bottom: 3rem;
    }
  }
</style>
