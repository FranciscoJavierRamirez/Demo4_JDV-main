---
import { getCollection } from 'astro:content';

interface Props {
  title: string;
  subtitle: string;
}

const { title, subtitle } = Astro.props;

// Obtener todos los miembros del equipo ordenados
const teamMembers = await getCollection('team');
const sortedMembers = teamMembers.sort((a, b) => a.data.order - b.data.order);
---

<section id="team" class="relative py-20 bg-[var(--blue-deeper)] overflow-hidden">
  <!-- Background Effects -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute inset-0 opacity-[0.03]" style="background-image: linear-gradient(rgba(255,255,255,0.2) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.2) 1px, transparent 1px); background-size: 50px 50px;"></div>
    <div class="absolute top-1/4 left-0 w-[500px] h-[500px] bg-[radial-gradient(circle,rgba(59,130,246,0.12)_0%,transparent_70%)] blur-[100px] rounded-full"></div>
    <div class="absolute bottom-0 right-1/4 w-[400px] h-[400px] bg-[radial-gradient(circle,rgba(201,162,84,0.08)_0%,transparent_70%)] blur-[100px] rounded-full"></div>
  </div>

  <div class="container relative z-10">
    <!-- Section Header -->
    <div class="team-header text-center mb-16">
      <h2 class="text-[clamp(2rem,4vw,3rem)] font-bold text-white mb-4" style="font-family: var(--font-display);">
        {title}
      </h2>
      <p class="text-lg text-white/80 max-w-xl mx-auto">
        {subtitle}
      </p>
      <div class="w-24 h-1 bg-gradient-to-r from-[var(--gold)] to-transparent mx-auto mt-6 rounded-full opacity-80"></div>
    </div>

    <!-- Team Grid: 4 miembros -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
      {sortedMembers.map((member, index) => (
        <div
          class={`team-card group relative rounded-3xl overflow-hidden transition-all duration-500 hover:-translate-y-3 ${member.data.featured ? 'shadow-[0_8px_40px_rgba(201,169,97,0.2)]' : 'shadow-xl'}`}
          data-index={index}
        >
          <!-- Image -->
          <div class="aspect-[3/4] overflow-hidden bg-[var(--gray-800)]">
            <img
              src={member.data.image}
              alt={member.data.name}
              class="w-full h-full object-cover object-top transition-transform duration-700 group-hover:scale-110"
              loading="lazy"
              onerror="this.onerror=null; this.src='/team/placeholder.svg'; this.dataset.fallback='true';"
            />
          </div>

          <!-- Gradient Overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-[rgba(12,35,64,0.98)] via-[rgba(12,35,64,0.4)] to-transparent"></div>

          <!-- Content -->
          <div class="absolute bottom-0 left-0 right-0 p-6 text-white">
            {member.data.featured && (
              <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-[var(--gold)]/20 backdrop-blur-sm rounded-full text-xs font-semibold text-[var(--gold-light)] mb-3 border border-[var(--gold)]/30">
                <i class="fas fa-star text-[10px]"></i>
                Fundadora
              </span>
            )}

            <h3 class="text-xl font-bold mb-1" style="font-family: var(--font-display);">
              {member.data.name}
            </h3>

            <p class="text-white/70 text-sm font-medium mb-3">
              {member.data.role}
            </p>

            <p class="text-white/60 text-sm leading-relaxed line-clamp-3 group-hover:line-clamp-none transition-all duration-300">
              {member.data.shortDescription || member.data.description}
            </p>

            {member.data.credentials && member.data.credentials.length > 0 && (
              <div class="mt-4 pt-4 border-t border-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <ul class="space-y-1">
                  {member.data.credentials.slice(0, 2).map(credential => (
                    <li class="flex items-center gap-2 text-xs text-white/70">
                      <i class="fas fa-check text-[var(--gold)] text-[10px]"></i>
                      {credential}
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>

          {/* Featured border glow */}
          {member.data.featured && (
            <div class="absolute inset-0 rounded-3xl border-2 border-[var(--gold)]/30 pointer-events-none"></div>
          )}
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  /* Team header entrance */
  .team-header {
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .team-header.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Team cards entrance */
  .team-card {
    opacity: 0;
    transform: translateY(50px) scale(0.95);
  }

  .team-card.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Staggered delays para 4 miembros */
  .team-card[data-index="0"].visible { transition-delay: 0ms; }
  .team-card[data-index="1"].visible { transition-delay: 150ms; }
  .team-card[data-index="2"].visible { transition-delay: 300ms; }
  .team-card[data-index="3"].visible { transition-delay: 450ms; }

  /* Line clamp utility */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .group:hover .line-clamp-none {
    -webkit-line-clamp: unset;
  }

  @media (prefers-reduced-motion: reduce) {
    .team-header,
    .team-card {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>

<script is:inline>
  (function() {
    const initTeamAnimation = () => {
      const section = document.querySelector('#team');
      const header = section?.querySelector('.team-header');
      const cards = section?.querySelectorAll('.team-card');

      if (!section) return;

      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (prefersReducedMotion) {
        header?.classList.add('visible');
        cards?.forEach(card => card.classList.add('visible'));
        return;
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            header?.classList.add('visible');

            cards?.forEach((card, index) => {
              setTimeout(() => {
                card.classList.add('visible');
              }, 300 + (index * 150));
            });

            observer.disconnect();
          }
        });
      }, { threshold: 0.1 });

      observer.observe(section);
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTeamAnimation);
    } else {
      initTeamAnimation();
    }
  })();
</script>
