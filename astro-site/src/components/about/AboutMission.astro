---
interface Value {
  icon: string;
  title: string;
  description: string;
  detail?: string;
}

interface Vision {
  title: string;
  text: string;
}

interface Props {
  title: string;
  text: string;
  values: Value[];
  vision?: Vision;
}

const { title, text, values, vision } = Astro.props;

// Split text into paragraphs for better formatting
const paragraphs = text.split('\n\n').filter(p => p.trim());
---

<section id="mission" class="relative py-20 md:py-28 lg:py-32 overflow-hidden bg-[var(--blue-deeper)]">
  <!-- Complex Mesh Gradient Background (Hero-style) -->
  <div class="absolute inset-0 z-0">
    <div class="absolute top-[-20%] left-[-10%] w-[70%] h-[70%] rounded-full 
         bg-[radial-gradient(circle,rgba(59,130,246,0.4)_0%,transparent_70%)] 
         blur-[120px] animate-[float_20s_ease-in-out_infinite]"></div>
    <div class="absolute bottom-[-10%] right-[-5%] w-[60%] h-[60%] rounded-full 
         bg-[radial-gradient(circle,rgba(29,78,216,0.4)_0%,transparent_70%)] 
         blur-[100px] animate-[float_25s_ease-in-out_infinite_reverse]"></div>
    <div class="absolute top-[40%] left-[30%] w-[40%] h-[40%] rounded-full 
         bg-[radial-gradient(circle,rgba(201,162,84,0.15)_0%,transparent_70%)] 
         blur-[80px] animate-[float_15s_ease-in-out_infinite_5s]"></div>
  </div>

  <!-- Noise Texture Overlay -->
  <div class="absolute inset-0 z-1 opacity-[0.03] pointer-events-none mix-blend-overlay" 
       style="background-image: url('data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noise\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noise)\'/%3E%3C/svg%3E');"></div>

  <!-- Gradient Overlay for Depth -->
  <div class="absolute inset-0 z-2 bg-gradient-to-br from-[rgba(12,35,64,0.98)] via-[rgba(12,35,64,0.94)] to-[rgba(26,77,122,0.88)]"></div>

  <div class="container relative z-10">
    <!-- Mission & Vision Grid -->
    <div class="mission-header grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 max-w-6xl mx-auto mb-12 md:mb-16">

      <!-- Mission Statement -->
      <div class="mission-block group relative text-center lg:text-left p-6 md:p-8 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10
                  hover:bg-white/[0.08] hover:border-white/20 hover:shadow-[0_12px_40px_rgba(201,169,97,0.15)]
                  transition-all duration-500 cursor-default overflow-hidden">
        <!-- Spotlight Effect on Hover -->
        <div class="absolute inset-0 opacity-0 group-hover:opacity-100
                    transition-opacity duration-500 pointer-events-none z-[1]
                    bg-[radial-gradient(600px_circle_at_var(--mouse-x)_var(--mouse-y),rgba(201,169,97,0.08),transparent_40%)]">
        </div>

        <!-- Content -->
        <div class="relative z-10">
          <!-- Badge glassmorphism -->
          <span class="inline-flex items-center gap-2 px-3 py-1.5 sm:px-4 sm:py-2
                       bg-white/10 backdrop-blur-lg rounded-full
                       border border-white/20 text-xs sm:text-sm font-semibold text-white
                       mb-3 sm:mb-4 shadow-lg group-hover:border-[var(--gold)]/30 transition-colors duration-300">
            <i class="fas fa-bullseye text-[var(--gold)] text-sm"></i>
            Nuestra Misión
          </span>

          <!-- Título blanco -->
          <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white mb-4
                     drop-shadow-[0_2px_8px_rgba(0,0,0,0.3)]"
              style="font-family: var(--font-display);">
            {title}
          </h2>

          <!-- Texto de misión con párrafos -->
          <div class="space-y-4">
            {paragraphs.map(paragraph => (
              <p class="text-sm sm:text-base leading-relaxed text-white/80">
                {paragraph}
              </p>
            ))}
          </div>
        </div>
      </div>

      <!-- Vision Statement -->
      {vision && (
        <div class="vision-block group relative text-center lg:text-left p-6 md:p-8 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10
                    hover:bg-white/[0.08] hover:border-white/20 hover:shadow-[0_12px_40px_rgba(201,169,97,0.15)]
                    transition-all duration-500 cursor-default overflow-hidden">
          <!-- Spotlight Effect on Hover -->
          <div class="absolute inset-0 opacity-0 group-hover:opacity-100
                      transition-opacity duration-500 pointer-events-none z-[1]
                      bg-[radial-gradient(600px_circle_at_var(--mouse-x)_var(--mouse-y),rgba(201,169,97,0.08),transparent_40%)]">
          </div>

          <!-- Content -->
          <div class="relative z-10">
            <!-- Badge glassmorphism -->
            <span class="inline-flex items-center gap-2 px-3 py-1.5 sm:px-4 sm:py-2
                         bg-white/10 backdrop-blur-lg rounded-full
                         border border-white/20 text-xs sm:text-sm font-semibold text-white
                         mb-3 sm:mb-4 shadow-lg group-hover:border-[var(--gold)]/30 transition-colors duration-300">
              <i class="fas fa-eye text-[var(--gold)] text-sm"></i>
              Nuestra Visión
            </span>

            <!-- Título blanco -->
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white mb-4
                       drop-shadow-[0_2px_8px_rgba(0,0,0,0.3)]"
                style="font-family: var(--font-display);">
              {vision.title}
            </h2>

            <!-- Texto de visión -->
            <p class="text-sm sm:text-base leading-relaxed text-white/80">
              {vision.text}
            </p>
          </div>
        </div>
      )}
    </div>

    <!-- Bento Grid Layout (Apple-inspired) -->
    <div class="mission-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
      {values.map((value, index) => (
        <div
          class="value-card group relative p-6 md:p-8 bg-white/10 backdrop-blur-lg border border-white/20 
                 rounded-2xl shadow-[0_8px_30px_rgba(0,0,0,0.3)]
                 hover:shadow-[0_12px_40px_rgba(201,169,97,0.25),0_0_60px_rgba(201,169,97,0.15)]
                 transition-all duration-500 hover:-translate-y-2 hover:border-white/30
                 overflow-hidden cursor-pointer"
          data-index={index}
        >
          <!-- Spotlight Effect on Hover -->
          <div class="absolute inset-0 opacity-0 group-hover:opacity-100 
                      transition-opacity duration-500 pointer-events-none z-[1]
                      bg-[radial-gradient(600px_circle_at_var(--mouse-x)_var(--mouse-y),rgba(201,169,97,0.12),transparent_40%)]">
          </div>

          <!-- Content -->
          <div class="relative z-10">
            <!-- Icon con fondo glassmorphism -->
            <div class="w-14 h-14 flex items-center justify-center 
                        bg-gradient-to-br from-[var(--gold)]/20 to-[var(--gold)]/10 
                        rounded-xl mb-4 group-hover:scale-110 transition-transform duration-300
                        border border-[var(--gold)]/30 shadow-[0_4px_12px_rgba(201,169,97,0.2)]">
              <i class={`${value.icon} text-xl text-[var(--gold)]`}></i>
            </div>

            <!-- Title -->
            <h3 class="text-lg font-bold text-white mb-2" 
                style="font-family: var(--font-display);">
              {value.title}
            </h3>

            <!-- Description -->
            <p class="text-sm text-white/70 leading-relaxed mb-3">
              {value.description}
            </p>

            <!-- Detail (optional) -->
            {value.detail && (
              <p class="text-xs text-white/60 leading-relaxed italic border-l-2 border-[var(--gold)]/40 pl-3 mt-3 
                        opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                {value.detail}
              </p>
            )}
          </div>

          <!-- Hover border glow -->
          <div class="absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 
                      transition-opacity duration-500 pointer-events-none
                      bg-gradient-to-br from-[var(--gold)]/20 via-transparent to-transparent 
                      blur-xl">
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  /* ========================================
     Mission Section Premium Animations
     ======================================== */

  /* Mission header entrance */
  .mission-header {
    opacity: 1;
  }

  /* Mission block entrance animation */
  .mission-block {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .mission-block.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Vision block entrance animation */
  .vision-block {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.15s,
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.15s;
  }

  .vision-block.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Mission grid entrance */
  .mission-grid {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s,
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s;
  }

  .mission-grid.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Value cards entrance */
  .value-card {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
  }

  .value-card.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Staggered delays */
  .value-card[data-index="0"].visible { transition-delay: 0ms; }
  .value-card[data-index="1"].visible { transition-delay: 100ms; }
  .value-card[data-index="2"].visible { transition-delay: 200ms; }
  .value-card[data-index="3"].visible { transition-delay: 300ms; }

  /* Float animations para orbes */
  @keyframes float {
    0%, 100% { 
      transform: translate(0, 0) scale(1); 
    }
    33% { 
      transform: translate(60px, -80px) scale(1.1); 
    }
    66% { 
      transform: translate(-60px, 60px) scale(0.9); 
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .mission-block,
    .vision-block,
    .mission-grid,
    .value-card {
      opacity: 1;
      transform: none;
      transition: none;
    }

    [class*="animate-[float"] {
      animation: none !important;
    }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    #mission {
      padding-top: 3rem;
      padding-bottom: 3rem;
    }
  }
</style>

<script is:inline>
  (function() {
    const initMissionAnimation = () => {
      const section = document.querySelector('#mission');
      const missionBlock = section?.querySelector('.mission-block');
      const visionBlock = section?.querySelector('.vision-block');
      const grid = section?.querySelector('.mission-grid');
      const cards = section?.querySelectorAll('.value-card');

      if (!section) return;

      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (prefersReducedMotion) {
        missionBlock?.classList.add('visible');
        visionBlock?.classList.add('visible');
        grid?.classList.add('visible');
        cards?.forEach(card => card.classList.add('visible'));
        return;
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // Animate mission block first
            missionBlock?.classList.add('visible');

            // Animate vision block with slight delay
            setTimeout(() => {
              visionBlock?.classList.add('visible');
            }, 150);

            // Animate grid
            setTimeout(() => {
              grid?.classList.add('visible');
            }, 300);

            // Animate value cards with stagger
            cards?.forEach((card, index) => {
              setTimeout(() => {
                card.classList.add('visible');
              }, 500 + (index * 100));
            });

            observer.disconnect();
          }
        });
      }, { threshold: 0.15 });

      observer.observe(section);

      // Check inmediato para elementos ya en viewport (fix Chrome)
      const rect = section.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) {
        missionBlock?.classList.add('visible');
        setTimeout(() => visionBlock?.classList.add('visible'), 150);
        setTimeout(() => grid?.classList.add('visible'), 300);
        cards?.forEach((card, index) => {
          setTimeout(() => card.classList.add('visible'), 500 + (index * 100));
        });
        observer.disconnect();
      }

      // Mouse tracking for spotlight effect on value cards
      cards?.forEach(card => {
        card.addEventListener('mousemove', (e) => {
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          card.style.setProperty('--mouse-x', `${x}px`);
          card.style.setProperty('--mouse-y', `${y}px`);
        });
      });

      // Mouse tracking for mission and vision blocks
      [missionBlock, visionBlock].forEach(block => {
        if (!block) return;
        block.addEventListener('mousemove', (e) => {
          const rect = block.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          block.style.setProperty('--mouse-x', `${x}px`);
          block.style.setProperty('--mouse-y', `${y}px`);
        });
      });
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMissionAnimation);
    } else {
      initMissionAnimation();
    }
  })();
</script>
