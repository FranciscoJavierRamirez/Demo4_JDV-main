---
interface Props {
  text: string;
  commitments: string[];
}

const { text, commitments } = Astro.props;

// Iconos predeterminados para cada commitment
const defaultIcons = ['üí°', '‚öñÔ∏è', 'ü§ù', 'üéØ', '‚ú®', 'üõ°Ô∏è'];
---

<section class="practice-objective" id="practice-objective">
  <!-- Background Elements -->
  <div class="objective-bg">
    <div class="objective-orb objective-orb-1"></div>
    <div class="objective-orb objective-orb-2"></div>
    <div class="objective-grid"></div>
  </div>

  <div class="container">
    <!-- Header -->
    <div class="section-header objective-header-reveal">
      <span class="section-badge">
        <i class="fas fa-target-crosshairs"></i>
        Objetivo
      </span>
      <h2>Mi compromiso contigo</h2>
    </div>

    <!-- Main Text -->
    <div class="objective-main objective-main-reveal">
      <div class="objective-text-wrapper">
        <div class="objective-quote"></div>
        <p class="objective-text">{text}</p>
      </div>
    </div>

    <!-- Commitment Cards -->
    <div class="commitment-grid">
      {commitments.map((commitment, index) => (
        <div 
          class="commitment-card commitment-card-reveal" 
          data-index={index}
        >
          <div class="commitment-icon-wrapper">
            <div class="commitment-icon-glow"></div>
            <span class="commitment-icon">{defaultIcons[index % defaultIcons.length]}</span>
          </div>
          <p>{commitment}</p>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .practice-objective {
    position: relative;
    padding: var(--space-20) 0;
    background: linear-gradient(135deg, #1E40AF 0%, #2563EB 50%, #1E40AF 100%);
    color: white;
    overflow: hidden;
  }

  /* ========================================
     BACKGROUND ELEMENTS
     ======================================== */
  .objective-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
  }

  .objective-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(100px);
    mix-blend-mode: screen;
  }

  .objective-orb-1 {
    top: -20%;
    right: 10%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(201, 169, 97, 0.18) 0%, transparent 70%);
    animation: objectiveOrbFloat 20s ease-in-out infinite;
  }

  .objective-orb-2 {
    bottom: -10%;
    left: 20%;
    width: 350px;
    height: 350px;
    background: radial-gradient(circle, rgba(59, 130, 246, 0.22) 0%, transparent 70%);
    animation: objectiveOrbFloat 25s ease-in-out infinite reverse;
  }

  @keyframes objectiveOrbFloat {
    0%, 100% {
      transform: translate(0, 0) scale(1);
      opacity: 0.6;
    }
    25% {
      transform: translate(60px, -80px) scale(1.1);
      opacity: 0.9;
    }
    50% {
      transform: translate(-40px, -40px) scale(0.95);
      opacity: 0.7;
    }
    75% {
      transform: translate(-60px, 60px) scale(1.05);
      opacity: 0.8;
    }
  }

  .objective-grid {
    position: absolute;
    inset: 0;
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 40px 40px;
  }

  /* ========================================
     CONTAINER
     ======================================== */
  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 var(--space-6);
    position: relative;
    z-index: 10;
  }

  /* ========================================
     SECTION HEADER
     ======================================== */
  .section-header {
    text-align: center;
    margin-bottom: var(--space-10);
  }

  .section-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: white;
    font-size: 0.8125rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 50px;
    margin-bottom: var(--space-5);
  }

  .section-badge i {
    color: var(--gold);
    font-size: 0.75rem;
  }

  .section-header h2 {
    font-family: var(--font-display);
    font-size: clamp(2rem, 4vw, 2.75rem);
    font-weight: 700;
    letter-spacing: -0.02em;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  /* ========================================
     MAIN TEXT
     ======================================== */
  .objective-main {
    margin-bottom: var(--space-12);
  }

  .objective-text-wrapper {
    position: relative;
    text-align: center;
    padding: var(--space-10);
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
  }

  .objective-quote {
    position: absolute;
    top: var(--space-6);
    left: var(--space-8);
    width: 60px;
    height: 60px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23c9a961' opacity='0.3'%3E%3Cpath d='M6.5 10c-.223 0-.437.034-.65.065.069-.232.14-.468.254-.68.114-.308.292-.575.469-.844.148-.291.409-.488.601-.737.201-.242.475-.403.692-.604.213-.21.492-.315.714-.463.232-.133.434-.28.65-.35l.539-.222.474-.197-.485-1.938-.597.144c-.191.048-.424.104-.689.171-.271.05-.56.187-.882.312-.317.143-.686.238-1.028.467-.344.218-.741.4-1.091.692-.339.301-.748.562-1.05.944-.33.358-.656.734-.909 1.162C4.043 8.463 3.751 9.01 3.563 9.6c-.183.596-.291 1.243-.291 1.943 0 1.381.559 2.607 1.465 3.5.906.893 2.132 1.457 3.513 1.457 1.381 0 2.607-.564 3.5-1.457.893-.893 1.457-2.119 1.457-3.5S12.056 9.036 11.25 8.25c-.657-.636-1.516-1.033-2.467-1.14-.097-.011-.195-.018-.292-.024a6.003 6.003 0 0 0-.991.007zm7.5 0c-.223 0-.437.034-.65.065.069-.232.14-.468.254-.68.114-.308.292-.575.469-.844.148-.291.409-.488.601-.737.201-.242.475-.403.692-.604.213-.21.492-.315.714-.463.232-.133.434-.28.65-.35l.539-.222.474-.197-.485-1.938-.597.144c-.191.048-.424.104-.689.171-.271.05-.56.187-.882.312-.317.143-.686.238-1.028.467-.344.218-.741.4-1.091.692-.339.301-.748.562-1.05.944-.33.358-.656.734-.909 1.162-.267.39-.559.936-.747 1.526-.183.596-.291 1.243-.291 1.943 0 1.381.559 2.607 1.465 3.5.906.893 2.132 1.457 3.513 1.457 1.381 0 2.607-.564 3.5-1.457.893-.893 1.457-2.119 1.457-3.5s-.564-2.507-1.457-3.293c-.657-.636-1.516-1.033-2.467-1.14-.097-.011-.195-.018-.292-.024a6.003 6.003 0 0 0-.991.007z'/%3E%3C/svg%3E") no-repeat center center;
    background-size: contain;
    opacity: 0.3;
  }

  .objective-text {
    font-size: clamp(1.25rem, 2.5vw, 1.5rem);
    line-height: 1.8;
    font-weight: 400;
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
    position: relative;
    z-index: 2;
  }

  /* ========================================
     COMMITMENT GRID
     ======================================== */
  .commitment-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--space-5);
  }

  /* ========================================
     COMMITMENT CARDS
     ======================================== */
  .commitment-card {
    position: relative;
    text-align: center;
    padding: var(--space-7);
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .commitment-card:hover {
    transform: translateY(-6px);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(201, 169, 97, 0.3);
    box-shadow: 
      0 20px 40px -10px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(201, 169, 97, 0.15);
  }

  /* Icon */
  .commitment-icon-wrapper {
    position: relative;
    width: 72px;
    height: 72px;
    margin: 0 auto var(--space-5);
  }

  .commitment-icon-glow {
    position: absolute;
    inset: -10px;
    background: radial-gradient(circle, rgba(201, 169, 97, 0.25) 0%, transparent 70%);
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .commitment-card:hover .commitment-icon-glow {
    opacity: 1;
    animation: practicePulseGlow 2s ease-in-out infinite;
  }

  .commitment-icon {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(201, 169, 97, 0.2) 0%, rgba(212, 175, 55, 0.15) 100%);
    border: 1px solid rgba(201, 169, 97, 0.3);
    border-radius: 18px;
    font-size: 2rem;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .commitment-card:hover .commitment-icon {
    transform: scale(1.1) rotate(-5deg);
    background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
    box-shadow: 0 8px 24px rgba(201, 169, 97, 0.4);
  }

  /* Text */
  .commitment-card p {
    font-size: 1rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
  }

  /* ========================================
     SCROLL REVEAL
     ======================================== */
  .objective-header-reveal {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .objective-header-reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .objective-main-reveal {
    opacity: 0;
    transform: translateY(30px) scale(0.98);
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.15s;
  }

  .objective-main-reveal.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .commitment-card-reveal {
    opacity: 0;
    transform: translateY(30px) scale(0.97);
    transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .commitment-card-reveal.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* Stagger */
  .commitment-card-reveal[data-index="0"].visible { transition-delay: 300ms; }
  .commitment-card-reveal[data-index="1"].visible { transition-delay: 400ms; }
  .commitment-card-reveal[data-index="2"].visible { transition-delay: 500ms; }
  .commitment-card-reveal[data-index="3"].visible { transition-delay: 600ms; }

  /* ========================================
     RESPONSIVE
     ======================================== */
  @media (max-width: 768px) {
    .practice-objective {
      padding: var(--space-16) 0;
    }

    .objective-text-wrapper {
      padding: var(--space-8) var(--space-6);
    }

    .objective-quote {
      width: 40px;
      height: 40px;
      top: var(--space-4);
      left: var(--space-4);
    }

    .commitment-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-4);
    }

    .commitment-card {
      padding: var(--space-5);
    }

    .commitment-icon-wrapper {
      width: 56px;
      height: 56px;
    }

    .commitment-icon {
      font-size: 1.5rem;
    }
  }

  /* ========================================
     REDUCED MOTION
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .objective-orb-1,
    .objective-orb-2 {
      animation: none;
    }

    .objective-header-reveal,
    .objective-main-reveal,
    .commitment-card-reveal {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.getElementById('practice-objective');
    if (!section) return;

    const header = section.querySelector('.objective-header-reveal');
    const main = section.querySelector('.objective-main-reveal');
    const cards = section.querySelectorAll('.commitment-card-reveal');

    // Check for reduced motion
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (prefersReducedMotion) {
      header?.classList.add('visible');
      main?.classList.add('visible');
      cards.forEach(card => card.classList.add('visible'));
      return;
    }

    // Scroll reveal
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          header?.classList.add('visible');
          main?.classList.add('visible');
          cards.forEach((card, i) => {
            setTimeout(() => card.classList.add('visible'), 300 + i * 100);
          });
          observer.disconnect();
        }
      });
    }, { threshold: 0.15 });

    observer.observe(section);
  });
</script>
